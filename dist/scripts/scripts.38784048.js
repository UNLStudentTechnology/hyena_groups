"use strict";angular.module("hyenaGroupsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngStorage","firebase","angularMoment","hyenaAngular","ngTagsInput","ngCsv"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/group/new",{templateUrl:"views/new.html",controller:"NewCtrl"}).when("/group/:groupId",{templateUrl:"views/group.html",controller:"GroupCtrl"}).when("/group/:groupId/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]).config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).constant("FBURL","https://hyena-groups.firebaseio.com/").constant("APIKEY","MGE0OWQ2ZjUwMDc4YjU0MzdkNTBiNzA4").constant("APIPATH","http://st-studio.unl.edu/hyena_platform/public/api/1.0/").constant("PLATFORM_ROOT","http://st-studio.unl.edu/hyena_platform/public/").constant("angularMomentConfig",{}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"}),angular.module("hyenaGroupsApp").controller("ApplicationCtrl",["$rootScope","$scope","$location","$window","$routeParams","$firebase","AuthService","UserService","AppFirebase","Notification","FBURL","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l){if(b.appLoaded=null,b.currentUser=null,a.currentGroupId=0,angular.isDefined(c.search().token)){var m=c.search().token;c.url(c.path());{i.authenticate(m).then(function(a){b.appLoaded=!0,g.manualLogin(a.uid,m,"groups").then(function(a){b.currentUser=a.data},function(a){console.log("Login failed:",a)})},function(a){console.error("Login failed:",a)})}}else g.check()&&null!==i.getAuthRef().$getAuth()?g.user("groups").then(function(a){b.appLoaded=!0,b.currentUser=a.data}):(g.login(),j.showModal("Please log in","#modal-content-login","takeover"));b.$watch("currentUser",function(a,b){null===b||!angular.isUndefined(a)&&null!==a?null!==b&&j.hideModal():j.showModal("Please log in","#modal-content-login","takeover")}),a.$on(l.notAuthenticated,function(){g.expire(),b.currentUser=null,g.login()}),b.setCurrentUser=function(a){b.currentUser=a},b.logOutCurrentUser=function(){b.currentUser=null,g.logout()},b.logIn=function(){g.check()||g.login()},b.toggleMainDrawer=function(){document.querySelector("unl-layout").toggleDrawer()},b.closeMainDrawer=function(){document.querySelector("unl-layout").closeDrawer()},b.showLoginWindow=function(){j.setModalContent("#modal-content-login")},b.closeModal=function(){j.hideModal()},b.go=function(a,e){b.pageAnimationClass="undefined"==typeof e?"animate-slide-right":e,"back"===a?(b.pageAnimationClass="animate-slide-left",d.history.back()):c.path(a)}}]),angular.module("hyenaGroupsApp").controller("MainCtrl",["$scope",function(){}]),angular.module("hyenaGroupsApp").service("GroupService",["$http","AuthService","APIPATH","APIKEY",function(a,b,c,d){var e="token="+b.authToken(),f="api_key="+d;return{get:function(b,d){return d=d||"",a.get(c+"groups/"+b+"?with="+d+"&"+f)},update:function(b,d){return a.put(c+"groups/"+b+"?"+e,d)},add:function(b){return a.post(c+"groups?"+e+"&"+f,b)},usersAdd:function(b,d){return a.post(c+"groups/"+b+"/users?"+e+"&"+f,d)},usersRemove:function(b,d){return a.post(c+"groups/"+b+"/users/delete?"+e+"&"+f,d)}}}]),angular.module("hyenaGroupsApp").controller("GroupCtrl",["$scope","$rootScope","$routeParams","Notification","GroupService",function(a,b,c,d,e){a.selectedTab=0,a.sortDirection=!1,a.sortField="first_name",a.usersAddList=[],a.selectedUser=null;var f=[],g=b.currentGroupId=parseInt(c.groupId);e.get(g,"users,apps").then(function(b){a.group=b.data,a.members=b.data.users,a.apps=b.data.apps}),a.toggleSort=function(){a.sortDirection=!a.sortDirection},a.addUsers=function(){var b={users:[]};angular.forEach(a.usersAddList,function(a){b.users.push(a.text)}),e.usersAdd(g,b).then(function(b){a.usersAddList=[],angular.forEach(b.data.users_added,function(b){a.members.push(b)}),d.hideModal(),d.show(b.data.message,"success")},function(a){d.show(a.data,"error")})},a.showAddModal=function(){d.showModal("Add new members","#modal-members-add")},a.removeUsers=function(){for(var b={users:[]},c=0;c<f.length;c++)b.users.push(f[c][1]);e.usersRemove(g,b).then(function(b){for(var c=0;c<f.length;c++)a.members.splice(a.members.indexOf(f[c][0]),1);f=[],d.hideModal(),d.show(b.data.message,"success")},function(a){d.show(a.data,"error")})},a.showRemoveModal=function(b){f.push([b,b.uni_auth]),a.selectedUser=b.uni_auth,d.showModal("","#modal-member-remove")},a.splitTags=function(b){var c=b.text.split(",");if(c.length>1){a.usersAddList.pop();for(var d=0;d<c.length;d++)c[d]=c[d].toString().trim(),a.usersAddList.push({text:c[d]});console.log(a.usersAddList)}}}]),angular.module("hyenaGroupsApp").controller("SettingsCtrl",["$scope","$rootScope","$routeParams","GroupService",function(a,b,c,d){var e=b.currentGroupId=parseInt(c.groupId);d.get(e,"users").then(function(b){a.group=b.data,a.members=b.data.users})}]),angular.module("hyenaGroupsApp").controller("NewCtrl",["$scope","Notification","GroupService",function(a,b,c){a.group={title:"",description:""},a.createGroup=function(){c.add(a.group).then(function(c){a.currentUser.groups.push(c.data),a.go("group/"+c.data.id),b.show(c.data,"success")},function(a){b.show(a.data,"error")})}}]);